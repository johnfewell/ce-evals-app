<div id="evaluation-main" data-id="<%= params[:id] %>">

</div>
<div class="mt-3">

</div>

<a href="#" class="js-next btn" data-id="<%=@evaluation.id%>">Next Evaluation</a>

<script type="text/javascript" charset="utf-8">

   $(function() {
     const evalId = parseInt($("#evaluation-main").attr("data-id"))
     $.get("/evaluations/" + evalId + ".json", function(evaluation){
        addEvalToDom(evaluation)
      })
      addEventHanlder()
  })

  function addEventHanlder(){
    $(".js-next").on("click", function(event) {
      var nextId = parseInt($(".js-next").attr("data-id")) + 1;
      $.ajax({
        method : "GET",
        url : "/evaluations/" + nextId + ".json",
        dataType : "json",
        timeout : 100000,
        success : function(evaluation) {
          addEvalToDom(evaluation)
          $(".js-next").attr("data-id", evaluation.id)
        },
        error : function(e) {
            console.info("Error, this isn't working");
        },
        done : function(e) {
            console.info("DONE");
        }
    });
    // $.get("/evaluations/" + nextId + ".json", function(evaluation){
    //       addEvalToDom(evaluation)
    //       $(".js-next").attr("data-id", evaluation.id)
    //   });
      event.preventDefault()
    })
  }

   function addEvalToDom(eval) {
      eval.course = eval.course || {}
        let newEval = new Evaluation(eval.id, eval.name, eval.course.title, eval.course.start_date, eval.questions)
       $('#evaluation-main').html(newEval.renderEval())
   }

   function Evaluation(id, name, course, start_date, questions){
     this.id = id
     this.name = name
     this.course = course
     this.start_date = start_date
     this.questions = questions
   }

   Evaluation.prototype.renderEval = function() {
     let questionList = this.questions.reduce((questionString, question) => {
       return questionString + `<li>${question.content}</li>`
     }, "" )
     console.log(questionList)
     return `
         <div class="d-inline-block mb-1">
           <h2>
              ${this.name}
           </h2>
         </div>
         <div class="f4 text-gray mt-2">
               <span class="mr-3" itemprop="programmingLanguage">
                 Class: ${this.course}
               </span>
             Date: ${this.start_date}
         </div>
         <div class="mt-3"></div>
         <div>
          <h4>Questions</h4>
          <ul id="questions" class="f6 text-gray mt-2 mx-5">
            ${questionList}
          </ul>
         </div>
     `}

</script>
